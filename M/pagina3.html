<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autobezit & Treinstation</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f8f9fa;
            color: #000000;
        }
        .navbar {
            background-color: #ffffff;
            border: 1px solid #ced4da;
            margin-bottom: 10px;
        }

        .content {
            padding: 20px;
            border: 1px solid #ced4da;
        }

        h1 {
            margin-bottom: 20px;
        }
        .filter-map-container {
            display: flex;
            width: 100%;
            border: 1px solid #ced4da;
            height: 650; /* Vaste hoogte ingesteld */
        }
        .filter-container {
            width: 30%;
            padding: 20px;
            background-color: #ffffff;
        }
        .map-container {
            width: 70%;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #map {
            width: 90%;
            height: 100%; /* Volledige hoogte benutten */
        }
        .table-container {
            margin-top: 2%;
            display: flex;
            justify-content: center;
        }

        .table {
            width: 100%;
            background-color: #ffffff;
            color: #000000;
        }
        .form-group-inline {
            display: flex;
            flex-wrap: wrap;
        }
        .form-group-inline .form-group {
            width: 45%;
            margin-right: 5%;
            margin-bottom: 5px;
        }
        .form-group-inline .form-group:last-child {
            margin-right: 0;
        }
        .btn-primary {
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Bootstrap Navigatiemenu -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">Introductie</a></li>
                <li class="nav-item"><a class="nav-link" href="pagina3.html">Autobezit & Afstand treinstations</a></li>
                <li class="nav-item"><a class="nav-link" href="pagina2.html">Schatting Reisgedrag</a></li>
                <li class="nav-item"><a class="nav-link" href="pagina4.html">Reisgedrag & BE cluster</a></li>
            </ul>
        </div>
    </nav>

    <div class="filter-map-container">
        <div class="filter-container">
    <h3>Afstand station & autobezit</h3>
    <p>Filter postcodes op basis van gemiddeld autobezit (per huishouden) en afstand tot stations, of voer een postcode in en visualiseer vergelijkbare postcodes.</p>
    <p>Bronnen: <a href="https://www.kimnet.nl/atlas-van-de-auto#alle-data" target="_blank">Autobezit</a>, <a href="https://www.cbs.nl/nl-nl/longread/diversen/2024/statistische-gegevens-per-vierkant-en-postcode-2021-2022-2023" target="_blank">Gegevens per postcode (2022)</a></p>

    <div class="form-group-inline">
        <div class="form-group">
            <label for="min_treinstation">Min Treinstation (km):</label>
            <input type="number" class="form-control" id="min_treinstation" min="0" max="50" step="1" value="0" style="height: 30px">
        </div>
        <div class="form-group">
            <label for="max_treinstation">Max. Treinstation (km):</label>
            <input type="number" class="form-control" id="max_treinstation" min="0" max="50" step="1" value="2" style="height: 30px">
        </div>
        <div class="form-group">
            <label for="min_carown">Min. Autobezit:</label>
            <input type="number" class="form-control" id="min_carown" min="0" max="5" step="0.05" value="0.8" style="height: 30px">
        </div>
        <div class="form-group">
            <label for="max_carown">Max. Autobezit:</label>
            <input type="number" class="form-control" id="max_carown" min="0" max="5" step="0.05" value="1.5" style="height: 30px">
        </div>
    </div>

    <!-- Filter knop -->
    <button id="filter_btn" class="btn btn-primary" style="width:200px; font-size: 14px; height: 33px; margin-top: 5px; margin-bottom: 5px;">Filter</button>

    <!-- Postcode invoerveld -->
    <div style="max-width: 150px; margin-bottom: 5px;">
        <label for="postcode_input">Postcode:</label>
        <input type="text" id="postcode_input" class="form-control" placeholder="1234" maxlength="4" style="height: 30px">
    </div>

    <!-- Zoek vergelijkbare postcodes knop -->
    <button id="zoek_btn" class="btn btn-primary" style="width:200px; height: 33px; margin-top: 5px;font-size: 14px;">Zoek vergelijkbare postcodes</button>

    <!-- Legenda -->
    <div style="margin-top: 10px; width: 80%; border: 2px solid grey; font-size: 12px; background-color: white; padding: 10px; display: flex; justify-content: center; margin-left: auto; margin-right: auto;">
        <div style="text-align: left;">
            <b>Cluster Legend</b><br>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: pink; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Suburban train
            </div>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: darkorange; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Midsized cities/TOD urbanization
            </div>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: yellowgreen; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Greenports and distant residential area's
            </div>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: darkolivegreen; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Distant cultural landscape
            </div>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: springgreen; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Logistics and "lint bebouwing"  
            </div>
            <div style="clear: both; margin-bottom: 5px;">
                <i style="background: red; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Large cities
            </div>
            <div style="clear: both;">
                <i style="background: purple; width: 18px; height: 18px; display: inline-block; margin-right: 8px;"></i> Residential urban sprawl
            </div>
        </div>
    </div>
</div>


        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>

    <div class="table-container">
        <div class="scrollable-table">
            <table class="table table-striped" id="data_table">
                <thead>
                    <tr>
                        <th>Postcode</th>
                        <th>Afstand tot Treinstation (km)</th>
                        <th>Autobezit per huishouden in wijk</th>
                        <th>Huishoudens in wijk</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamisch ingevuld door jQuery -->
                </tbody>
            </table>
        </div>
    </div>

   <script>
    let geoData; // Variabele voor GeoJSON-data
    const map = L.map('map').setView([52.0116, 4.3571], 9.3); // Initiëer de kaart

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 19
    }).addTo(map);

    // Kleuren voor clusters
    const clusterColors = {
        1: 'pink',
        2: 'darkorange',
        3: 'yellowgreen',
        4: 'darkolivegreen',
        5: 'springgreen',
        6: 'red',
        7: 'purple'
    };

    // Laad GeoJSON data
    $.getJSON('data/gdf_output.geojson', function(data) {
        geoData = data;
        addGeoJsonLayer(geoData); // Voeg de GeoJSON laag toe aan de kaart
    });

    function addGeoJsonLayer(data, selectedPostcode = null) {
        // Voeg GeoJSON-lagen toe met kleuren op basis van 'clu#'
        L.geoJSON(data, {
            style: function (feature) {
                return {
                    color: 'black',
                    weight: 0.4,
                    fillColor: feature.properties.PC4 === selectedPostcode ? 'yellow' : clusterColors[feature.properties['clu#']],
                    fillOpacity: 0.75
                };
            },
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(`<h3>Postcode: ${feature.properties.PC4}</h3>
                    <table>
                        <tr><td>Huishoudens:</td><td>${feature.properties.totaalHH.toFixed(0)}</td></tr>
                        <tr><td>Treinstation (km):</td><td>${feature.properties['treinstation (km)'].toFixed(2)}</td></tr>
                        <tr><td>Autobezit:</td><td>${feature.properties.carown_y.toFixed(2)}</td></tr>                     
                    </table>`);
            }
        }).addTo(map);
    }

    $('#filter_btn').click(function() {
        const min_treinstation = parseFloat($('#min_treinstation').val());
        const max_treinstation = parseFloat($('#max_treinstation').val());
        const min_carown = parseFloat($('#min_carown').val());
        const max_carown = parseFloat($('#max_carown').val());

        // Filter de GeoJSON data
        const filteredFeatures = geoData.features.filter(feature => {
            const properties = feature.properties;
            return (
                properties['treinstation (km)'] >= min_treinstation &&
                properties['treinstation (km)'] <= max_treinstation &&
                properties.carown_y >= min_carown &&
                properties.carown_y <= max_carown
            );
        });

        // Maak de kaart leeg en voeg gefilterde data toe
        map.eachLayer(function(layer) {
            if (layer instanceof L.GeoJSON) {
                map.removeLayer(layer);
            }
        });

        addGeoJsonLayer({ "type": "FeatureCollection", "features": filteredFeatures });

        // Update de tabel
        const tableBody = $('#data_table tbody');
        tableBody.empty();
        filteredFeatures.forEach(feature => {
            const properties = feature.properties;
            tableBody.append(`
                <tr>
                    <td>${properties.PC4}</td>
                    <td>${properties['treinstation (km)'].toFixed(2)}</td>
                    <td>${properties.carown_y.toFixed(2)}</td>
                    <td>${properties['totaalHH']}</td>
                </tr>
            `);
        });
    });

    // Functie om vergelijkbare postcodes te zoeken
    $('#zoek_btn').click(function() {
        const inputPostcode = $('#postcode_input').val().trim();
        const selectedFeature = geoData.features.find(feature => feature.properties.PC4 == inputPostcode); // Gebruik == voor correcte vergelijking met nummerieke waarden

        if (selectedFeature) {
            const selectedProperties = selectedFeature.properties;
            const min_treinstation = selectedProperties['treinstation (km)'] - 0.6;
            const max_treinstation = selectedProperties['treinstation (km)'] + 0.6;
            const min_carown = selectedProperties.carown_y - 0.15;
            const max_carown = selectedProperties.carown_y + 0.15;

            // Filter vergelijkbare postcodes
            const similarFeatures = geoData.features.filter(feature => {
                const properties = feature.properties;
                return (
                    properties['treinstation (km)'] >= min_treinstation &&
                    properties['treinstation (km)'] <= max_treinstation &&
                    properties.carown_y >= min_carown &&
                    properties.carown_y <= max_carown &&
                    properties.PC4 != inputPostcode // Zelfde postcode uitsluiten
                );
            });

            // Maak de kaart leeg en voeg gefilterde data toe
            map.eachLayer(function(layer) {
                if (layer instanceof L.GeoJSON) {
                    map.removeLayer(layer);
                }
            });

            // Toon de geselecteerde postcode in geel en vergelijkbare in standaard kleuren
            addGeoJsonLayer({ "type": "FeatureCollection", "features": [selectedFeature, ...similarFeatures] }, inputPostcode);

            // Update de tabel
            const tableBody = $('#data_table tbody');
            tableBody.empty();
            similarFeatures.forEach(feature => {
                const properties = feature.properties;
                tableBody.append(`
                    <tr>
                        <td>${properties.PC4}</td>
                        <td>${properties['treinstation (km)'].toFixed(2)}</td>
                        <td>${properties.carown_y.toFixed(2)}</td>
                        <td>${properties['totaalHH']}</td>
                    </tr>
                `);
            });
        } else {
            alert('Postcode niet gevonden.');
        }
    });
</script>
</body>
</html>
